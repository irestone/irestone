/** @jsxImportSource @emotion/react */

import { GetStaticPaths, GetStaticProps, InferGetServerSidePropsType } from 'next'
import Head from 'next/head'
import { FC } from 'react'

import { getPosts, TPostData } from '../../lib/api'
import Layout from '../../components/layout'
import Post from '../../components/post'

const getStaticPaths: GetStaticPaths = async () => {
  const posts = await getPosts({ locale: 'all' })
  const paths = posts.map(({ slug, locale }) => ({ params: { slug }, locale }))
  return { paths, fallback: true }
}

const getStaticProps: GetStaticProps<{ post: TPostData }> = async ({ locale, params }) => {
  if (!params?.slug) throw new Error('No params')
  const posts = await getPosts({ locale, where: { slug: params.slug } })
  if (!posts[0]) throw new Error('Could not find the post')
  return { props: { post: posts[0], messages: require(`../../locales/${locale}.json`) } }
}

const Experiment: FC<InferGetServerSidePropsType<typeof getStaticProps>> = ({ post }) => {
  return (
    <>
      <Head>
        <title>{`IRESTONE.SPACE | ${post.title}`}</title>
        <meta name='description' content='Generated by create next app' />
      </Head>
      <Layout>
        <Post post={post} />
      </Layout>
    </>
  )
}

export { getStaticPaths, getStaticProps }
export default Experiment
